SELECT 
  CONVERT(date, OEDCONFIRMDT) AS 'ORDER DATE', 
  OEDDOCNAME AS 'PRACTITIONER', 
  IOCATEGORY.IONAME as 'CATEGORY', 
  COUNT(distinct oebook.PVISITNO) AS 'ORDER COUNT'
FROM oedetail WITH (NOLOCK)
left join oebook with (nolock) on oebook.OEBID = oedetail.OEBID
left join istock WITH (NOLOCK) on istock.ISCODE = oedetail.OEDISCODE
left join iservices WITH (NOLOCK) on iservices.ISCODE = oedetail.OEDISCODE
left join IOCATEGORY WITH (NOLOCK) on IOCATEGORY.IOCODE = istock.ISORDERCATEGORY OR IOCATEGORY.IOCODE = iservices.ISORDERCATEGORY
WHERE 
  OEDCONFIRMDT >= @startdate 
  AND OEDCONFIRMDT < DATEADD(day, 1, @enddate) 
  AND OEDCANCELLED = '0'
  AND OEDDOCNAME IS NOT NULL
  AND IOCATEGORY.IONAME IS NOT NULL
  AND oedetail.OEDORDERSETID IS NULL
GROUP BY 
  OEDDOCNAME, 
  CONVERT(date, OEDCONFIRMDT),
  IOCATEGORY.IONAME
